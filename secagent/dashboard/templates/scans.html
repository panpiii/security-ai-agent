{% extends "base.html" %}

{% block title %}All Scans - Security AI Agent{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <h1 class="h2 mb-0">
            <i class="fas fa-list me-2"></i>All Scans
        </h1>
        <p class="text-muted">Complete history of all security scans</p>
    </div>
</div>

<!-- Filters -->
<div class="row mb-4">
    <div class="col-md-12">
        <div class="card">
            <div class="card-body">
                <form method="get" action="/scans" class="row g-3">
                    <div class="col-md-4">
                        <label for="limit" class="form-label">Results per page</label>
                        <select class="form-select" id="limit" name="limit">
                            <option value="20" {% if limit == 20 %}selected{% endif %}>20</option>
                            <option value="50" {% if limit == 50 %}selected{% endif %}>50</option>
                            <option value="100" {% if limit == 100 %}selected{% endif %}>100</option>
                        </select>
                    </div>
                    <div class="col-md-6">
                        <label for="project" class="form-label">Filter by project</label>
                        <input type="text" class="form-control" id="project" name="project" 
                               placeholder="Project name" value="{{ project_filter or '' }}">
                    </div>
                    <div class="col-md-2">
                        <label class="form-label">&nbsp;</label>
                        <button type="submit" class="btn btn-primary w-100">
                            <i class="fas fa-filter me-1"></i>Filter
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Scans Table -->
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="card-title mb-0">
                    <i class="fas fa-history me-2"></i>Scan History
                    <span class="badge bg-secondary ms-2">{{ scans|length }}</span>
                </h5>
            </div>
            <div class="card-body p-0">
                {% if scans %}
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>Scan ID</th>
                                <th>Project</th>
                                <th>Target</th>
                                <th>Risk Score</th>
                                <th>Dep Vulns</th>
                                <th>Code Issues</th>
                                <th>Branch</th>
                                <th>Timestamp</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for scan in scans %}
                            <tr class="scan-item">
                                <td>
                                    <code class="small">{{ scan.scan_id[:8] }}...</code>
                                </td>
                                <td>
                                    {% if scan.project_name %}
                                    <span class="badge bg-info">{{ scan.project_name }}</span>
                                    {% else %}
                                    <span class="text-muted">—</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <span class="text-truncate d-inline-block" style="max-width: 250px;" title="{{ scan.target_path }}">
                                        {{ scan.target_path }}
                                    </span>
                                </td>
                                <td>
                                    <span class="risk-score {{ getRiskClass(scan.overall_risk_score) }}">
                                        {{ scan.overall_risk_score }}
                                    </span>
                                    <small class="text-muted">/10</small>
                                </td>
                                <td>
                                    <span class="badge bg-{{ 'danger' if scan.dependency_vulnerabilities > 0 else 'success' }}">
                                        {{ scan.dependency_vulnerabilities }}
                                    </span>
                                </td>
                                <td>
                                    <span class="badge bg-{{ 'warning' if scan.code_issues > 0 else 'success' }}">
                                        {{ scan.code_issues }}
                                    </span>
                                </td>
                                <td>
                                    {% if scan.branch_name %}
                                    <code class="small">{{ scan.branch_name }}</code>
                                    {% else %}
                                    <span class="text-muted">—</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <small class="text-muted">{{ formatTimestamp(scan.scan_timestamp) }}</small>
                                </td>
                                <td>
                                    {% if scan.success %}
                                    <span class="badge bg-success">Success</span>
                                    {% else %}
                                    <span class="badge bg-danger">Failed</span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="text-center py-5">
                    <i class="fas fa-search fa-3x text-muted mb-3"></i>
                    <h5 class="text-muted">No scans found</h5>
                    <p class="text-muted">Run your first security scan to see results here.</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

